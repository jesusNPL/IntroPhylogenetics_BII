plot(network, vertex.color=my_color, edge.width=E(network)$importance*2 )
legend("bottomleft", legend=levels(as.factor(V(network)$carac))  , col = coul , bty = "n", pch=20 , pt.cex = 3, cex = 1.5, text.col=coul , horiz = FALSE, inset = c(0.1, 0.1))
remotes::install_github("lbusett/prismaread")
remotes::install_github("lbusett/prismaread")
install.packages("exactextractr")
remotes::install_github("lbusett/prismaread")
library(prismaread)
# NOT RUN {
library(ggplot2)
# Example for `geom_ridgeline_gradient()`
d <- data.frame(
x = rep(1:5, 3) + c(rep(0, 5), rep(0.3, 5), rep(0.6, 5)),
y = c(rep(0, 5), rep(1, 5), rep(3, 5)),
height = c(0, 1, 3, 4, 0, 1, 2, 3, 5, 4, 0, 5, 4, 4, 1)
)
View(d)
ggplot(d, aes(x, y, height = height, group = y, fill = factor(x+y))) +
geom_ridgeline_gradient() +
scale_fill_viridis_d(direction = -1) +
theme(legend.position = 'none')
# NOT RUN {
library(ggplot2)
# Example for `geom_ridgeline_gradient()`
d <- data.frame(
x = rep(1:5, 3) + c(rep(0, 5), rep(0.3, 5), rep(0.6, 5)),
y = c(rep(0, 5), rep(1, 5), rep(3, 5)),
height = c(0, 1, 3, 4, 0, 1, 2, 3, 5, 4, 0, 5, 4, 4, 1)
)
ggplot(d, aes(x, y, height = height, group = y, fill = factor(x+y))) +
geom_ridgeline_gradient() +
scale_fill_viridis_d(direction = -1) +
theme(legend.position = 'none')
install.packages("ggridges")
library(ggridges)
ggplot(d, aes(x, y, height = height, group = y, fill = factor(x+y))) +
geom_ridgeline_gradient() +
scale_fill_viridis_d(direction = -1) +
theme(legend.position = 'none')
# Example for `geom_density_ridges_gradient()`
ggplot(lincoln_weather, aes(x = `Mean Temperature [F]`, y = `Month`, fill = stat(x))) +
geom_density_ridges_gradient(scale = 3, rel_min_height = 0.01) +
scale_x_continuous(expand = c(0, 0)) +
scale_y_discrete(expand = c(0, 0)) +
scale_fill_viridis_c(name = "Temp. [F]", option = "C") +
coord_cartesian(clip = "off") +
labs(title = 'Temperatures in Lincoln NE in 2016') +
theme_ridges(font_size = 13, grid = TRUE) +
theme(axis.title.y = element_blank())
library(phytools)
massMat <- as.matrix(dist(dat$mass, diag=TRUE, upper=TRUE))
bodyMassA <- rnorm(n=100, mean=10)
bodyMassA <- sort(bodyMassA)
bodyMassB <- rnorm(n=100, mean=1)
bodyMassB <- sort(bodyMassB)
trait1A <- rnorm(n=100, mean=0.1)
trait1B <- rnorm(n=100, mean=0.1)
trait1A <- sort(trait1A, decreasing=FALSE)
trait1B <- sort(trait1B, decreasing=TRUE)
dat <- data.frame(mass=c(bodyMassA,bodyMassB), trait=c(trait1A,trait1B))
View(dat)
summary(lm(dat$trait~dat$mass))
summary(lm(dat$trait[1:100]~dat$mass[1:100]))
summary(lm(dat$trait[101:200]~dat$mass[101:200]))
plot(dat)
library(phytools)
massMat <- as.matrix(dist(dat$mass, diag=TRUE, upper=TRUE))
traitMat <- as.matrix(dist(dat$trait, diag=TRUE, upper=TRUE))
massMatPositive <- massMat
massMatPositive[massMatPositive <= median(massMatPositive)] <- NA
traitMatPositive <- traitMat
traitMatPositive[is.na(massMatPositive)] <- NA
massMatNegative <- massMat
massMatNegative[massMatNegative > median(massMatNegative)] <- NA
traitMatNegative <- traitMat
traitMatNegative[is.na(massMatNegative)] <- NA
multi.mantel(traitMat, massMat, nperm=100)
multi.mantel(traitMatPositive, massMatPositive, nperm=100)
multi.mantel(traitMatNegative, massMatNegative, nperm=100)
massMatNegative
library(asnipe)
install.packages("asnipe")
library(asnipe)
## define group memberships (or read from file)
individuals <‐ data.frame(ID=c(“C695905”,“H300253”,“H300253”,
“H300283”,“H839876”,“F464557”,“H300296”,“H300253”,
“F464557”,“H300296”,“C695905”, “H300283”,“H839876”),
GROUP=c(1,1,2,2,2,3,3,4,5,5,6,6,6))
## define group memberships (or read from file)
individuals <‐ data.frame(ID=c('C695905','H300253','H300253',
'H300283','H839876','F464557','H300296','H300253',
'F464557','H300296','C695905', 'H300283','H839876'),
GROUP=c(1,1,2,2,2,3,3,4,5,5,6,6,6))
## define group memberships (or read from file)
individuals <‐ data.frame(ID=+c('C695905','H300253','H300253',
'H300283','H839876','F464557','H300296','H300253',
'F464557','H300296','C695905', 'H300283','H839876'),
GROUP=c(1,1,2,2,2,3,3,4,5,5,6,6,6))
c('C695905','H300253','H300253',
'H300283','H839876','F464557','H300296','H300253',
'F464557','H300296','C695905', 'H300283','H839876')
ID = +c('C695905','H300253','H300253',
'H300283','H839876','F464557','H300296','H300253',
'F464557','H300296','C695905', 'H300283','H839876')
c('C695905','H300253','H300253',
'H300283','H839876','F464557','H300296','H300253',
'F464557','H300296','C695905', 'H300283','H839876')
ID = c('C695905','H300253','H300253',
'H300283','H839876','F464557','H300296','H300253',
'F464557','H300296','C695905', 'H300283','H839876')
GROUP = c(1, 1, 2, 2, 2, 3, 3, 4, 5, 5, 6, 6, 6)
## define group memberships (or read from file)
individuals <‐ data.frame(ID = c('C695905','H300253','H300253',
'H300283','H839876','F464557','H300296','H300253',
'F464557','H300296','C695905', 'H300283','H839876'),
GROUP = c(1, 1, 2, 2, 2, 3, 3, 4, 5, 5, 6, 6, 6))
individuals <- data.frame(ID, GROUP)
individuals
gbi <‐ get_group_by_individual(individuals, data_format="individuals")
## define group memberships (or read from file)
individuals <- data.frame(ID = c('C695905','H300253','H300253',
'H300283','H839876','F464557','H300296','H300253',
'F464557','H300296','C695905', 'H300283','H839876'),
GROUP = c(1, 1, 2, 2, 2, 3, 3, 4, 5, 5, 6, 6, 6))
individuals <- data.frame(ID, GROUP)
## define group memberships (or read from file)
individuals <- data.frame(ID = c('C695905','H300253','H300253',
'H300283','H839876','F464557','H300296','H300253',
'F464557','H300296','C695905', 'H300283','H839876'),
GROUP = c(1, 1, 2, 2, 2, 3, 3, 4, 5, 5, 6, 6, 6))
individuals
gbi <- get_group_by_individual(individuals, data_format="individuals")
gbi
groups <- list(G1=c('C695905','H300253'),
G2=c('H300253','H300283','H839876'),
G3=c('F464557','H300296'),
G4=c('H300253'),
G5=c('F464557','H300296'),
G6=c('C695905','H300283','H839876'))
R>groups
groups
gbi <‐ get_group_by_individual(groups, data_format='groups')
gbi <- get_group_by_individual(groups, data_format='groups')
gbi
Individuals <- cbind(individuals,
DAY=c(1,1,1,1,1,2,2,2,3,3,3,3,3))
Individuals
Individuals[,+ c(1,2)]
Individuals[,3]
Individuals[, c(1,2)]
SPs <- get_sampling_periods(Individuals[, c(1,2)],Individuals[,3],1,
data_format=Individuals)
SPs <- get_sampling_periods(Individuals[, + c(1,2)],Individuals[,3], 1,
data_format=Individuals)
?get_sampling_periods
## define group memberships (or read from file)
## define group memberships (these would be read from a file)
individuals <- data.frame(ID=c("C695905","H300253","H300253",
"H300283","H839876","F464557","H300296","H300253",
"F464557","H300296","C695905","H300283","H839876"),
GROUP=c(1,1,2,2,2,3,3,4,5,5,6,6,6))
## create a time column
individuals <- cbind(individuals,
DAY=c(1,1,1,1,1,2,2,2,3,3,3,3,3))
SPs <- get_sampling_periods(individuals[,c(1,2)],
individuals[,3],1,data_format="individuals")
occurs <- get_sampling_periods(individuals[,c(1,2)],
individuals[,3],1,data_format="individuals", return="occ")
## define group memberships (these would be read from a file)
groups <- list(G1=c("C695905","H300253"),
G2=c("H300253","H300283","H839876"),
G3=c("F464557","H300296"),
G4=c("H300253"),
G5=c("F464557","H300296"),
G6=c("C695905","H300283","H839876"))
## create a time variable
days <- c(1,1,2,2,3,3)
SPs <- get_sampling_periods(groups,
days,1,data_format="groups")
occurs <- get_sampling_periods(groups,
days,1,data_format="groups", return="occ")
occurs
SPs
?mrqap.ds
?mrqap.dsp
data("individuals")
data("group_by_individual")
data("individuals")
data("group_by_individual")
View(inds)
View(gbi)
# Generate network
network <- get_network(gbi)
data("individuals")
data("group_by_individual")
# Generate network
network <- get_network(gbi)
# Create a species similarity matrix
species <- array(0,dim(network))
network
species
# Create a sex similarity matrix
sex <- array(0,dim(network))
# Fill each matrix with 1 (same) or 0 (different)
for (i in 1:nrow(network)) {
species[,-i] <- as.numeric(inds$SPECIES[1] == inds$SPECIES[-i])
sex[,-i] <- as.numeric(inds$SEX[1] == inds$SEX[-i])
}
# Run mrqap.dsp
# Note randomisations are limited to 10 to reduce runtime
reg <- mrqap.dsp(network ~ species + sex, randomisations=10)
network
species
sex
# Look at results
reg
devtools::install_github("environmentalinformatics-marburg/satelliteTools")
install.packages("glcm")
devtools::install_github("environmentalinformatics-marburg/satelliteTools")
#load packages
library(raster)
library(RStoolbox)
#make up some endmember spectra: water and land
em_names <- c("water", "land")
pts <- data.frame(class=em_names, cell = c(47916,5294))
pts
#load an example dataset
data(lsat)
lsat
em <- lsat[pts$cell]
em
rownames(em) <- em_names
em
#unmix the image for water and land
probs <- mesma(lsat, em, method = "NNLS")
#take a look
raster::hist(probs$water)
raster::plot(probs$water, col = c("white","blue"))
raster::hist(probs$land)
raster::plot(probs$land, col = c("white","brown"))
?mesma
mesma
lsat
pts
tm <- readRDS("Dropbox/Lucie_Jesus/RCN_evolutionary_legacy/SLA_neotropical_complex.rds")
tm <- readRDS("Dropbox/Lucie_Jesus/RCN_evolutionary_legacy/Multilevel/SLA/SLA_neotropical_complex.rds")
library(brms)
tm
marginal_effects(tm)
tm <- readRDS("Dropbox/Lucie_Jesus/RCN_evolutionary_legacy/Multilevel/SLA/SLA_afrotropical_complex.rds")
tm <- readRDS("Dropbox/Lucie_Jesus/RCN_evolutionary_legacy/Multilevel/SLA/SLA_afrotropical_complex_FINAL.rds")
marginal_effects(tm)
tm
install.packages("torch")
library(torch)
library(torch)
x <- array(runif(8), dim = c(2, 2, 2))
y <- torch_tensor(x, dtype = torch_float64())
y
x
#> torch_tensor
#> (1,.,.) =
#>   0.5406  0.8648
#>   0.3097  0.9715
#>
#> (2,.,.) =
#>   0.1309  0.8992
#>   0.4849  0.1902
#> [ CPUDoubleType{2,2,2} ]
identical(x, as_array(y))
x <- torch_tensor(1, requires_grad = TRUE)
w <- torch_tensor(2, requires_grad = TRUE)
b <- torch_tensor(3, requires_grad = TRUE)
y <- w * x + b
y$backward()
x$grad
#> torch_tensor
#>  2
#> [ CPUFloatType{1} ]
w$grad
#> torch_tensor
#>  1
#> [ CPUFloatType{1} ]
b$grad
x <- torch_randn(100, 2)
x
y <- 0.1 + 0.5*x[,1] - 0.7*x[,2]
y
w <- torch_randn(2, 1, requires_grad = TRUE)
b <- torch_zeros(1, requires_grad = TRUE)
w
b
lr <- 0.5
for (i in 1:100) {
y_hat <- torch_mm(x, w) + b
loss <- torch_mean((y - y_hat$squeeze(1))^2)
loss$backward()
with_no_grad({
w$sub_(w$grad*lr)
b$sub_(b$grad*lr)
w$grad$zero_()
b$grad$zero_()
})
}
print(w)
install.packages("ape")
install.packages("ape")
install.packages("ape")
~/.R/Makevars
install.packages("ape")
install.packages(brms)
install.packages("brms")
install.packages(c("devtools", "raster", "phytools", "picante", "geiger"))
install.packages("tidybayes")
install.packages("tidyverse")
install.packages("knitr")
install.packages(c("rgdal", "rgeos", "maptools", "rworldmap", "letsR"))
install.packages(brms)
install.packages(brms)
install.packages("brms")
install.packages("BBMV")
source("0.Supporting_functions.R")
install.packages("blogdown")
setwd("Documents/GitHub")
"((A:10,B:9)D:5,C:15)F;"
if (!("ape" %in% installed.packages())) {install.packages("ape", dependencies = TRUE)}
require(ape)
## Here we will create a phylogenetic tree in Newick format
newick_tree <- "((A:10,B:9)D:5,C:15)F;"
## Read the tre
newick_tree <- read.tree(text = newick_tree)
## And now we can plot the phylogentic tree
plot(newick_tree, show.node.label = TRUE)
"#NEXUS
BEGIN TAXA;
DIMENSIONS NTAXA=3;
TaxLabels A B C;
END;
BEGIN TREES;
TREE=((A:10,B:9)D:5,C:15)F;
END;"
## First create a Nexus file in the working directory
cat(
"#NEXUS
BEGIN TAXA;
DIMENSIONS NTAXA=3;
TaxLabels A B C;
END;
BEGIN TREES;
TREE=((A:10,B:9)D:5,C:15)F;
END;",
file = "Data/Nexus_tree.nex"
)
## Now read the phylogenetic tree, but look that instead of using read.tree we are using read.nexus
nexus_tree <- read.nexus("Nexus_tree.nex")
## Now read the phylogenetic tree, but look that instead of using read.tree we are using read.nexus
nexus_tree <- read.nexus("Data/Nexus_tree.nex")
## lets plot the example
plot(nexus_tree, show.node.label = TRUE)
str(nexus_tree)
if (!("rotl" %in% installed.packages())) {install.packages("rotl", dependencies = TRUE)}
library(rotl)
if (!("rotl" %in% installed.packages())) {install.packages("rotl", dependencies = TRUE)}
library(rotl)
taxa <- c("Hyla", "Salmo", "Diadema", "Nautilus")
resolved_names <- tnrs_match_names(taxa)
resolved_names <- tnrs_match_names(taxa, context_name = "Animals")
otl_tree <- tol_induced_subtree(ott_ids = resolved_names$ott_id)
plot(otl_tree, no.margin = TRUE)
resolved_names
taxa <- c("Hyla", "Salmo", "Diadema", "Nautilus")
resolved_names <- tnrs_match_names(taxa)
resolved_names
otl_tree <- tol_induced_subtree(ott_ids = resolved_names$ott_id)
plot(otl_tree, no.margin = TRUE)
library(geiger)
trait <- "https://raw.githubusercontent.com/jesusNPL/IntroPhylogenetics_BII/master/Data/oaks_traits.csv"
phylo <- "https://raw.githubusercontent.com/jesusNPL/IntroPhylogenetics_BII/master/Data/oaks_Hipp_phylo.tre"
oakTraits <- read.csv(trait, row.names = 1)
oakPhylo <- read.tree("phylo")
oakPhylo <- read.tree(phylo)
oakPhylo <- drop.tip(oakPhylo, setdiff(oakPhylo$tip.label, rownames(oakTraits)))
name.check(oakPhylo, oakTraits) # Verify if species in the tree and the traits match
if (!("ape" %in% installed.packages())) {install.packages("ape", dependencies = TRUE)}
require(ape)
## Here we will create a phylogenetic tree in Newick format
newick_tree <- "((A:10,B:9)D:5,C:15)F;"
## Read the tre
newick_tree <- read.tree(text = newick_tree)
## And now we can plot the phylogentic tree
plot(newick_tree, show.node.label = TRUE)
## First create a Nexus file in the working directory
cat(
"#NEXUS
BEGIN TAXA;
DIMENSIONS NTAXA=3;
TaxLabels A B C;
END;
BEGIN TREES;
TREE=((A:10,B:9)D:5,C:15)F;
END;",
file = "Data/Nexus_tree.nex"
)
## Now read the phylogenetic tree, but look that instead of using read.tree we are using read.nexus
nexus_tree <- read.nexus("Data/Nexus_tree.nex")
## lets plot the example
plot(nexus_tree, show.node.label = TRUE)
str(nexus_tree)
nexus_tree$tip.label
nexus_tree$edge.length
nexus_tree$edge
# Lets plot the tree
plot(nexus_tree, show.tip.label = FALSE)
# Add the internal nodes
nodelabels()
# Add the tips or lineages
tiplabels()
# Simulate 10 phylogenies, each one with 5 species
multitree <- replicate(10, rcoal(5), simplify = FALSE)
# Store the list of trees as a multiPhylo object
class(multitree) <- "multiPhylo"
# Plot a single tree from the 10
plot(multitree[[10]])
par(mfrow = c(2, 2))
plot(multitree[[1]])
plot(multitree[[3]])
plot(multitree[[7]])
plot(multitree[[10]])
# Exporting the phylogenies as a single Newick file.
write.tree(phy = multitree, file = "Data/multitree_example_newick.txt")
multitree_example_newick <- read.tree("Data/multitree_example_newick.txt")
multitree_example_newick
# Exporting the phylogenies as a single Nexus file.
write.nexus(phy = multitree, file = "Data/multitree_example_nexus.nex")
multitree_example_nexus <- read.nexus("Data/multitree_example_nexus.nex")
multitree_example_nexus
if (!("rotl" %in% installed.packages())) {install.packages("rotl", dependencies = TRUE)}
library(rotl)
taxa <- c("Hyla", "Salmo", "Diadema", "Nautilus")
resolved_names <- tnrs_match_names(taxa)
resolved_names
otl_tree <- tol_induced_subtree(ott_ids = resolved_names$ott_id)
plot(otl_tree, no.margin = TRUE)
trait <- "https://raw.githubusercontent.com/jesusNPL/IntroPhylogenetics_BII/master/Data/oaks_traits.csv"
phylo <- "https://raw.githubusercontent.com/jesusNPL/IntroPhylogenetics_BII/master/Data/oaks_Hipp_phylo.tre"
oakTraits <- read.csv(trait, row.names = 1)
dim(oakTraits)
oakPhylo <- read.tree(phylo)
oakPhylo
oakPhylo <- drop.tip(oakPhylo, setdiff(oakPhylo$tip.label, rownames(oakTraits)))
name.check(oakPhylo, oakTraits) # Verify if species in the tree and the traits match
library(geiger)
name.check(oakPhylo, oakTraits) # Verify if species in the tree and the traits match
plot(sla ~ vein_length_by_area,
data = oakTraits,
xlab = "Vein length by area",
ylab = "Specific leaf area",
pch = 21, bg = "darkgray")
olsModel <- lm(sla ~ vein_length_by_area, data = oakTraits)
olsModel
summary(olsModel)
plot(sla ~ vein_length_by_area,
data = oakTraits,
xlab = "Vein length by area",
ylab = "Specific leaf area",
pch = 21, bg = "darkgray")
abline(olsModel, col = "red", lty = 2, lwd = 2)
sla <- setNames(oakTraits[, "sla"], rownames(oakTraits))
vla <- setNames(oakTraits[, "vein_length_by_area"], rownames(oakTraits))
pic_sla <- pic(sla, oakPhylo)
pic_vla <- pic(vla, oakPhylo)
picModel <- lm(pic_sla ~ pic_vla + 0)
picModel
summary(picModel)
plot(pic_sla ~ pic_vla,
xlab = "PCIs for Vein length by area",
ylab = "PICs for Specific leaf area",
pch = 21, bg = "darkgray")
abline(picModel, col = "blue", lty = 2, lwd = 2)
library(nlme)
library(rr2)
bm <- corBrownian(1, oakPhylo)
bm
# PGLS model
pglsModel <- gls(sla ~ vein_length_by_area,
data = oakTraits,
correlation = bm,
method = "ML")
summary(pglsModel)
coef(pglsModel)
R2(pglsModel, lik = TRUE)
plot(sla ~ vein_length_by_area,
data = oakTraits,
xlab = "Vein length by area",
ylab = "Specific leaf area",
pch = 21, bg = "darkgray")
abline(a = coef(pglsModel)[1], b = coef(pglsModel)[2], lwd = 2)
abline(olsModel, col = "red", lty = 2, lwd = 2)
legend("topright", lty = c(1, 2), legend = c("PGLS - BM", "uncorrected"),
col = c("black", "red"), lwd = 2)
library(phytools)
K_sla <- phylosig(tree = oakPhylo, # Phylogeny
x = setNames(oakTraits$sla, rownames(oakTraits)), # trait
method = "K", # method
test = TRUE)
print(K_sla)
plot(K_sla)
LB_sla <- phylosig(tree = oakPhylo,
x = setNames(oakTraits$sla, rownames(oakTraits)),
method = "lambda",
test = TRUE)
print(LB_sla)
plot(LB_sla)
